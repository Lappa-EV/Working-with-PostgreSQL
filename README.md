# Стажировка: система отслеживания изменений пользователей

## Описание

В рамках стажировки необходимо реализовать систему отслеживания изменений данных пользователей (имя, email, роль) в базе данных PostgreSQL.  Система должна логировать изменения в отдельной таблице аудита, экспортировать свежие изменения в CSV файл ежедневно и автоматизировать этот процесс с помощью pg_cron.

## Задачи

1.  **Логирование изменений:** Реализовать логирование всех изменений по полям `name`, `email` и `role` таблицы `users` в таблицу `users_audit`.
2.  **Триггер:** Создать триггер, автоматически срабатывающий при обновлении записи в таблице `users`, и вызывающий функцию логирования.
3.  **pg_cron:** Установить расширение `pg_cron` (предварительно установлено в Docker образе).
4.  **Экспорт данных:** Разработать функцию, которая будет извлекать все изменения за текущий день из таблицы `users_audit` и сохранять их в CSV файл в директории `/tmp/users_audit_export_<YYYYMMDD>.csv` внутри Docker контейнера.
5.  **Автоматизация:** Настроить планировщик `pg_cron` для ежедневного запуска функции экспорта в 3:00 ночи.

## Схема БД
```
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    email TEXT,
    role TEXT,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE users_audit (
    id SERIAL PRIMARY KEY,
    user_id INTEGER,
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    changed_by TEXT,
    field_changed TEXT,
    old_value TEXT,
    new_value TEXT
);
```

## Критерии оценки

*   Настроенный и работающий cron (видно в `cron.job`).
*   CSV файл с изменениями сохраняется в Docker контейнере по указанному пути.
*   Реализована функция логирования изменений и связанный с ней триггер.
*   Код оформлен в единый SQL скрипт.

## Инструкция по проверке

1.  Запустите Docker контейнер с предоставленным образом.
2.  Выполните предоставленный SQL скрипт.
3.  Убедитесь, что в таблице `cron.job` есть запись о запланированной задаче.
4.  Сделайте несколько изменений в таблице `users` (например, обновите `name`, `email` или `role`).
5.  Проверьте, что изменения записались в таблицу `users_audit`.
6.  Запустите функцию `export_daily_user_audit()` вручную.
7.  Проверьте наличие CSV файла в директории `/tmp` внутри Docker контейнера.
8.  Убедитесь, что CSV файл содержит свежие изменения из таблицы `users_audit`.

## Примечание

Предоставлен SQL скрипт, содержащий готовое решение задачи.  Прилагаются скриншоты с командами bash и расположением файла в Docker.
